<!DOCTYPE html>
<html lang="ko">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- <meta property="og:title" content="Meecord"/>
        <meta property="og:type" content=""/>
        <meta property="og:url" content="https://mee-cord.web.app/"/>
        <meta property="og:description" content=""/>
        <meta property="og:image" content="/images/logo_1600_630.png"/>
        <meta property="og:image:width" content="1200"/>
        <meta property="og:image:height" content="630"/>

        <meta name="title" content="Meecord">
        <meta name="description" content="">
        <meta name="author" content="Oh, Jung, Song, Joo">
        <meta name="generator" content="Hugo 0.88.1"> -->

  <title>Meecord</title>
  <link href="images/logo.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/sign-in/">



  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


  <!-- custom CSS -->
  <link href="meeting_start.css" rel="stylesheet">


  <!-- animate CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <!-- font ('jua') -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

  <!-- webrtc -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <meta name="apple-mobile-web-app-capable" content="yes">

</head>

<body>

  <style>
    video {

      border-radius: 7px;
      padding: 1rem;
      width: 100%;
      height: 90%;
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
      /* Safari and Chrome */
      -moz-transform: rotateY(180deg);
      /* Firefox */
    }

    button {
      margin: 5px 0px 0px 10px !important;
      width: 100%;
    }
  </style>

  <nav class="navbar">
    <div class="cover-container d-flex w-100 h-100 p-0 mx-auto flex-column">

      <header class="mb-auto">

        <div>
          <img class="float-md-start mb-0 feature" src="images/meecord-logo.png" onclick="location.href='cover.html'"
            alt="" width="132" height="48">
          <nav class="nav justify-content-center float-md-end">
            <a class="nav-link feature" onclick="location.href='cover.html'">홈</a>
            <a class="nav-link feature" onclick="location.href='conversation_list.html'">대화목록</a>
            <a class="nav-link feature" onclick="location.href='mypage.html'">마이페이지</a>
            <a class="nav-link feature" onclick="location.href='introduction.html'">소개</a>
            <a class="nav-link feature" onclick="location.href='index.html'">로그아웃</a>
          </nav>
        </div>


      </header>
    </div>
  </nav>


  <!-- 데스크탑 크기일 때 grid와 모바일 크기일 때 grid 구분 -->
  <div class="container">
    <div class="row" style="height:45vh">
      <div class="col-md-5">
        <div class="opponent-cam d-flex flex-column">상대 화면
          <video id="friendsVideo" autoplay playsinline></video>
        </div>
      </div>
      <div class="col-md-4">
        <div class="minute" id="min">
          <div class="minute-title">
            <p>대화록</p>
          </div>
          <div class="min-content">
            <p>내용</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="recommended-question" id="rq">
          <div class="keyword-question-title">
            <p>키워드 질문</p>
          </div>
          <div class="rq-content">
            <p>내용</p>
          </div>
          <div class="random-question-title">
            <p>랜덤 질문</p>
          </div>
          <div class="rq-content">
            <p>내용</p>
          </div>
          <div class="conversation-atmosphere">
            <div class="cv-content">
              <p>현재 대화 분위기는 기쁨입니다.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row" id="mycam">
      <div class="col-md-5">
        <div class="my-cam d-flex flex-column">
          내 화면
          <video id="yourVideo" autoplay muted playsinline></video>
        </div>
        <button onclick="showFriendsFace()" type="button" class="btn btn-primary btn-lg"><span
            class="glyphicon glyphicon-facetime-video" aria-hidden="true"></span> Call</button>
      </div>

    </div>
  </div>



  <script language="javascript">

    //Create an account on Firebase, and use the credentials they give you in place of the following
    var config = {
      apiKey: "AIzaSyAGjIonDdr_Y_697rDdZy2xj78ePRT_Lco",
      authDomain: "meecord-223cc.firebaseapp.com",
      databaseURL: "https://meecord-223cc-default-rtdb.firebaseio.com",
      projectId: "meecord-223cc",
      storageBucket: "meecord-223cc.appspot.com",
      messagingSenderId: "291741382850",
      appId: "1:291741382850:web:d91f54be8c6b004733e35b"
    };
    firebase.initializeApp(config);

    var database = firebase.database().ref();
    var yourVideo = document.getElementById("yourVideo");
    var friendsVideo = document.getElementById("friendsVideo");
    var yourId = Math.floor(Math.random() * 1000000000);
    //Create an account on Viagenie (http://numb.viagenie.ca/), and replace {'urls': 'turn:numb.viagenie.ca','credential': 'websitebeaver','username': 'websitebeaver@email.com'} with the information from your account
    var servers = { 'iceServers': [{ 'urls': 'stun:stun.services.mozilla.com' }, { 'urls': 'stun:stun.l.google.com:19302' }, { 'urls': 'turn:numb.viagenie.ca', 'credential': 'tjdfkr0907', 'username': 'osr0907@gmail.com' }] };
    var pc = new RTCPeerConnection(servers);
    pc.onicecandidate = (event => event.candidate ? sendMessage(yourId, JSON.stringify({ 'ice': event.candidate })) : console.log("Sent All Ice"));
    pc.onaddstream = (event => friendsVideo.srcObject = event.stream);

    function sendMessage(senderId, data) {
      var msg = database.push({ sender: senderId, message: data });
      msg.remove();
    }

    function readMessage(data) {
      var msg = JSON.parse(data.val().message);
      var sender = data.val().sender;
      if (sender != yourId) {
        if (msg.ice != undefined)
          pc.addIceCandidate(new RTCIceCandidate(msg.ice));
        else if (msg.sdp.type == "offer")
          pc.setRemoteDescription(new RTCSessionDescription(msg.sdp))
            .then(() => pc.createAnswer())
            .then(answer => pc.setLocalDescription(answer))
            .then(() => sendMessage(yourId, JSON.stringify({ 'sdp': pc.localDescription })));
        else if (msg.sdp.type == "answer")
          pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));
      }
    };

    database.on('child_added', readMessage);

    function showMyFace() {
      navigator.mediaDevices.getUserMedia({ audio: true, video: true })
        .then(stream => yourVideo.srcObject = stream)
        .then(stream => pc.addStream(stream));
    }

    function showFriendsFace() {
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .then(() => sendMessage(yourId, JSON.stringify({ 'sdp': pc.localDescription })));
    }
  </script>

  <script>
    // meeting_start 설정

    // <!-- 모바일 환경일때 mycam 가림 + 대화록, 질문추천 창 사이즈 조절 -->

    var mycam = document.getElementById('mycam');
    var yourvideo = document.getElementById('yourVideo');
    var min = document.getElementById('min');
    var rq = document.getElementById('rq');

    {/* // 웹페이지 로드할때 */ }
    window.onload = function (event) {
      showMyFace();
      var innerWidth = window.innerWidth;
      if (innerWidth <= "768") { hideMyCam(); adjustHalfSize(); }
      else { showMyCam(); adjustOriginSize(); }
    }

    {/* // 웹페이지 사이즈 조정할때 */ }
    window.onresize = function (event) {
      showMyFace();
      var innerWidth = window.innerWidth;
      if (innerWidth <= "768") { hideMyCam(); adjustHalfSize(); }
      else { showMyCam(); adjustOriginSize() }
    }

    hideMyCam = function () {
      mycam.style.display = "none";
      yourvideo.style.display = "none";
    }
    showMyCam = function () {
      mycam.style.display = "block";

    }
    adjustOriginSize = function () {
      min.style.height = "90vh";
      rq.style.height = "90vh";
    }
    adjustHalfSize = function () {
      min.style.height = "45vh";
      rq.style.height = "45vh";
    }
  </script>

</body>

</html>